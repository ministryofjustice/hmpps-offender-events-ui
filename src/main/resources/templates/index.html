<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" lang="en"
      xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
      layout:decorate="~{fragments/layout}">
<head>
    <title>Offender Events UI</title>
    <script type="text/javascript">
        function resetFilter() {
            includeAllEventTypes()
            excludeNoEventTypes()
            document.getElementById("text-filter").value = "";
            document.getElementById("filter-form").submit();
        }

        function includeAllEventTypes() {
            document.getElementById("include-all-event-types").checked = true
            document.getElementById("include-all-event-types").disabled = true
            Array.from(document.getElementsByClassName("include-event-checkbox")).map((element) => element.checked = false)
        }

        function changeIncludeEventType() {
            let selected = Array.from(document.getElementsByClassName("include-event-checkbox"))
            let checkAll = !selected.some((el) => el.checked)
            document.getElementById("include-all-event-types").checked = checkAll
            document.getElementById("include-all-event-types").disabled = checkAll
        }

        function excludeNoEventTypes() {
            document.getElementById("exclude-no-event-types").checked = true
            document.getElementById("exclude-no-event-types").disabled = true
            Array.from(document.getElementsByClassName("exclude-event-checkbox")).map((element) => element.checked = false)
        }

        function changeExcludeEventType() {
            let selected = Array.from(document.getElementsByClassName("exclude-event-checkbox"))
            let checkAll = !selected.some((el) => el.checked)
            document.getElementById("exclude-no-event-types").checked = checkAll
            document.getElementById("exclude-no-event-types").disabled = checkAll
        }
    </script>
</head>
<body>
<div layout:fragment="content" class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">Offender Events UI</h1>

    <div>
        <form id="filter-form" class="govuk-form-group" action="#" th:action="@{/messages}">
            <table class="govuk-table">
                <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header" scope="col">Include Event Types</th>
                    <th class="govuk-table__header" scope="col">Exclude Event Types</th>
                    <th class="govuk-table__header" scope="col">Include Text</th>
                </tr>
                </thead>
                <tbody class="govuk-table__body">
                <tr class="govuk-table__row">
                    <td class="govuk-table__cell">
                        <fieldset class="govuk-fieldset">
                            <div class="govuk-checkboxes">
                                <div class="govuk-checkboxes__item">
                                    <input id="include-all-event-types"
                                           name="include-all-event-types"
                                           class="govuk-checkboxes__input"
                                           type="checkbox"
                                           th:checked="${#lists.isEmpty(includeEventTypeFilter)}"
                                           th:disabled="${#lists.isEmpty(includeEventTypeFilter)}"
                                           onchange="includeAllEventTypes()">
                                    <label for="include-all-event-types" class="govuk-checkboxes__label">ALL</label>
                                </div>
                                <th:block th:each="eventType : ${allEventTypes}">
                                    <div class="govuk-checkboxes__item">
                                        <input th:id="'include-' + ${eventType}"
                                               name="include-event-type-filter"
                                               class="govuk-checkboxes__input include-event-checkbox"
                                               type="checkbox"
                                               th:value="${eventType}"
                                               th:checked="${includeEventTypeFilter != null and #lists.contains(includeEventTypeFilter, eventType)}"
                                               onchange="changeIncludeEventType()">
                                        <label th:for="'include-' + ${eventType} + '-event-type'" class="govuk-checkboxes__label"
                                               th:text="${eventType}"></label>
                                    </div>
                                </th:block>
                            </div>
                        </fieldset>
                    </td>
                    <td class="govuk-table__cell">
                        <fieldset class="govuk-fieldset">
                            <div class="govuk-checkboxes">
                                <div class="govuk-checkboxes__item">
                                    <input id="exclude-no-event-types"
                                           name="exclude-no-event-types"
                                           class="govuk-checkboxes__input"
                                           type="checkbox"
                                           th:checked="${#lists.isEmpty(excludeEventTypeFilter)}"
                                           th:disabled="${#lists.isEmpty(excludeEventTypeFilter)}"
                                           onchange="excludeNoEventTypes()">
                                    <label for="exclude-no-event-types" class="govuk-checkboxes__label">NONE</label>
                                </div>
                                <th:block th:each="eventType : ${allEventTypes}">
                                    <div class="govuk-checkboxes__item">
                                        <input th:id="'exclude-' + ${eventType}"
                                               name="exclude-event-type-filter"
                                               class="govuk-checkboxes__input exclude-event-checkbox"
                                               type="checkbox"
                                               th:value="${eventType}"
                                               th:checked="${excludeEventTypeFilter != null and #lists.contains(excludeEventTypeFilter, eventType)}"
                                               onchange="changeExcludeEventType()">
                                        <label th:for="'exclude-' + ${eventType} + '-event-type'" class="govuk-checkboxes__label"
                                               th:text="${eventType}"></label>
                                    </div>
                                </th:block>
                            </div>
                        </fieldset>
                    </td>
                    <td class="govuk-table__cell">
                        <input id="text-filter" name="text-filter" class="govuk-input" th:value="${textFilter}"/>
                    </td>
                </tr>
                </tbody>
            </table>
            <input class="govuk-button" type="submit" value="Filter"/>
            <input class="govuk-button" type="button" onclick="resetFilter()" value="Clear"/>
        </form>
    </div>

    <div>
        <h2 class="govuk-heading-m">Messages</h2>
        <table class="govuk-table">
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th class="govuk-table__header" scope="col">Event Type</th>
                <th class="govuk-table__header" scope="col">Keys</th>
                <th class="govuk-table__header" scope="col">Values</th>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            <tr th:each="displayMessage : ${displayMessages}" class="govuk-table__row">
                <td th:text="${displayMessage.eventType}" class="govuk-table__cell"></td>
                <td class="govuk-table__cell">
                    <th:block th:each="keyValuePair : ${displayMessage.messageDetails}">
                        <span th:text="${keyValuePair.key}"/>
                        <br/>
                    </th:block>
                </td>
                <td class="govuk-table__cell" style="white-space: nowrap">
                    <th:block th:each="keyValuePair : ${displayMessage.messageDetails}">
                        <span th:text="${keyValuePair.value}"/>
                        <br/>
                    </th:block>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
